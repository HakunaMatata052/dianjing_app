(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c166fb2"],{1227:function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,"",""])},"45ef":function(e,t,i){var a=i("a00c");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=i("499e").default;n("386f9c3e",a,!0,{})},6689:function(e,t,i){"use strict";i.r(t);var a=i("cebc"),n=(i("7f7f"),i("f499")),s=i.n(n),o=(i("3b2b"),i("ac6a"),i("f3e2"),i("8237")),l=i.n(o),r=i("ff6f"),c=(i("4917"),i("c5f6"),Number,Number,{props:{num:{type:Number,default:function(){return 9},required:!1},size:{type:Number,default:function(){return 15},required:!1}},methods:{openLoadPopup:function(){var e=this,t=this.$store.state.systemType;if(window.navigator.userAgent.match(/APICloud/i)){var i=api.require("UIMediaScanner");i.open({type:"picture",classify:!0,max:e.num,sort:{key:"time",order:"desc"},texts:{stateText:"已选择*项",cancelText:"取消",finishText:"完成"},styles:{bg:"#fff",mark:{icon:"",position:"bottom_left",size:20},nav:{bg:"#eee",stateColor:"#000",stateSize:18,cancelBg:"rgba(0,0,0,0)",cancelColor:"#000",cancelSize:18,finishBg:"rgba(0,0,0,0)",finishColor:"#000",finishSize:18}},scrollToBottom:{intervalTime:-1},exchange:!0,rotation:!0},function(a){if(a&&"confirm"==a.eventType){var n=[];a.list.forEach(function(s,o){"ios"==t?i.transPath({path:s.path},function(t){t&&(n.push(t.path),o==a.list.length-1&&e.$emit("selectImage",n))}):(n.push(s.path),o==a.list.length-1&&e.$emit("selectImage",n))})}})}}}}),p=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},u=[],f=i("2455");function d(e){i("7fed")}var m=!1,v=d,g="data-v-6d00116c",h=null,w=Object(f["a"])(c,p,u,m,v,g,h),b=w.exports,k=i("4a6d"),_=i("4669"),x=(r["a"],k["a"],_["a"],{name:"release-dynamic",components:{navBar:r["a"],uploadImage:b,userList:k["a"],positionStr:_["a"]},data:function(){return{imageShow:!1,pickerPopupShow:!1,userListPopupShow:!1,positionListPopupShow:!1,columns:[{id:0,text:"公开"},{id:1,text:"好友可见"},{id:2,text:"私密"}],owner:"公开",tagsList:"",pic:[],form:{mediaList:[],message:"",tagsList:[],friendsList:[],isfree:0,price:"",position:"",owner:0,onceonly:0}}},methods:{pickerOnConfirm:function(e){this.pickerPopupShow=!1,this.owner=e.text,this.form.owner=e.id},openImage:function(){this.pic.length>=9?this.$toast.fail("只能上传9张图片！"):this.$refs.upload.openLoadPopup()},delImage:function(e){this.pic.splice(e,1)},selectImage:function(e){var t=this;t.imageShow=!0,console.log(t.pic.length),t.pic.length+e.length>9?this.$toast.fail("只能上传9张图片！"):e.forEach(function(e){t.pic.push(e)})},tagsInput:function(e){var t,i=this,a=e,n=new RegExp("#([^#]{1,40})#","g"),s=[];while(null!=(t=n.exec(a)))s.push(t[1]);i.form.tagsList=s},selectUser:function(e){this.userListPopupShow=!1,"{}"!=s()(e)&&this.form.friendsList.push({userid:e.userId,nickname:e.nickName})},selectPosition:function(e){this.positionListPopupShow=!1,"{}"!=s()(e)&&(this.form.position=e.name)},delFriends:function(e){0==e?this.form.friendsList=[]:this.form.friendsList.splice(e,e)},releaseFn:function(){var e=this;if(0!=e.form.message.length){e.$toast.loading({duration:0,mask:!0,message:"正在上传图片..."});var t=api.require("qiniuUpfile");e.pic.forEach(function(i,a){t.upfile({file:i,name:l()(i)+".jpg"},function(t,i){t.status&&"complete"==t.oper&&(e.form.mediaList.push({url:e.$store.state.qiniuaddr+t.info.key}),a==e.pic.length-1&&e.addDynamicInformation())})})}else e.$toast.fail("请填写描述")},addDynamicInformation:function(){var e=this;e.$SERVER.addDynamicInformation(Object(a["a"])({userid:e.$store.state.userInfo.userid},e.form)).then(function(t){e.$toast.clear(),e.$toast.success("发布成功！"),e.$router.push("/dynamicDetail/"+t.data.inforid)})}}}),y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("navBar"),e._v(" "),i("div",{staticClass:"main"},[i("van-cell-group",{staticClass:"cell-group"},[i("van-cell",{staticClass:"cell",attrs:{"value-class":"duan-cell",size:"large"}},[i("template",{slot:"title"},[i("van-field",{attrs:{type:"textarea",placeholder:"添加有趣的描述，能让更多人看到你~",rows:"3"},model:{value:e.form.message,callback:function(t){e.$set(e.form,"message",t)},expression:"form.message"}})],1),e._v(" "),i("div",{staticClass:"image-box",on:{click:e.openImage}},[i("div",{staticClass:"van-uploader"},[i("div",{staticClass:"van-uploader__wrapper"},[i("div",{staticClass:"van-uploader__upload"},[i("i",{staticClass:"van-icon van-icon-plus van-uploader__upload-icon"})])])])])],2),e._v(" "),e.imageShow?i("div",{staticClass:"image-list"},[i("van-grid",{attrs:{border:!1,gutter:5,square:"","column-num":3}},e._l(e.pic,function(t,a){return i("van-grid-item",{key:a,staticClass:"image-item",on:{click:function(t){e.delImage(a)}}},[i("van-image",{staticClass:"image",attrs:{fit:"cover",src:t}})],1)}),1)],1):e._e(),e._v(" "),i("van-field",{staticClass:"cell",attrs:{type:"textarea",placeholder:"#添加话题#",rows:"1",autosize:"",size:"large"},on:{input:e.tagsInput},model:{value:e.tagsList,callback:function(t){e.tagsList=t},expression:"tagsList"}}),e._v(" "),0!=e.form.tagsList.length?i("van-cell",{attrs:{"title-class":"duan-cell",size:"large"}},[i("template",{slot:"title"},e._l(e.form.tagsList,function(t,a){return i("van-tag",{key:a,staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"large"}},[e._v(e._s(t))])}),1)],2):e._e(),e._v(" "),i("van-cell",{staticClass:"cell",attrs:{title:"@好友",size:"large"},on:{click:function(t){e.userListPopupShow=!0}}}),e._v(" "),0!=e.form.friendsList.length?i("van-cell",{attrs:{"title-class":"duan-cell",size:"large"}},[i("template",{slot:"title"},e._l(e.form.friendsList,function(t,a){return i("span",{key:a,staticClass:"friends-list",on:{click:function(t){e.delFriends(a)}}},[e._v("@"+e._s(t.nickname))])}),0)],2):e._e(),e._v(" "),i("van-field",{staticClass:"cell",attrs:{type:"input",placeholder:"添加位置","left-icon":"location-o",readonly:"",size:"large"},on:{click:function(t){e.positionListPopupShow=!0}},model:{value:e.form.position,callback:function(t){e.$set(e.form,"position",t)},expression:"form.position"}}),e._v(" "),i("van-switch-cell",{staticClass:"cell",attrs:{title:"是否收费",size:"large"},model:{value:e.form.isfree,callback:function(t){e.$set(e.form,"isfree",t)},expression:"form.isfree"}}),e._v(" "),i("transition",{attrs:{name:"fade"}},[e.form.isfree?i("van-field",{attrs:{title:"价格",placeholder:"金币",size:"large"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}}):e._e()],1),e._v(" "),i("van-switch-cell",{staticClass:"cell",attrs:{title:"是否阅后即焚",size:"large"},model:{value:e.form.onceonly,callback:function(t){e.$set(e.form,"onceonly",t)},expression:"form.onceonly"}}),e._v(" "),i("van-cell",{staticClass:"cell",attrs:{title:"分享范围",value:e.owner,"is-link":"",size:"large"},on:{click:function(t){e.pickerPopupShow=!0}}}),e._v(" "),i("van-cell",{staticClass:"submit-cell",attrs:{size:"large"}},[i("van-button",{staticClass:"submit",attrs:{size:"large",hairline:!1},on:{click:e.releaseFn}},[e._v("发布")])],1)],1)],1),e._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:e.pickerPopupShow,callback:function(t){e.pickerPopupShow=t},expression:"pickerPopupShow"}},[i("van-picker",{attrs:{"show-toolbar":"",columns:e.columns},on:{cancel:function(t){e.pickerPopupShow=!1},confirm:e.pickerOnConfirm}})],1),e._v(" "),i("van-popup",{staticStyle:{height:"100%"},attrs:{position:"bottom"},model:{value:e.userListPopupShow,callback:function(t){e.userListPopupShow=t},expression:"userListPopupShow"}},[i("userList",{on:{selectUser:e.selectUser}})],1),e._v(" "),i("van-popup",{staticStyle:{height:"100%"},attrs:{position:"bottom"},model:{value:e.positionListPopupShow,callback:function(t){e.positionListPopupShow=t},expression:"positionListPopupShow"}},[i("positionStr",{on:{selectPosition:e.selectPosition}})],1),e._v(" "),i("uploadImage",{ref:"upload",attrs:{num:9},on:{selectImage:e.selectImage}})],1)},L=[];function S(e){i("45ef")}var C=!1,P=S,$="data-v-462ea0ed",I=null,z=Object(f["a"])(x,y,L,C,P,$,I);t["default"]=z.exports},"7fed":function(e,t,i){var a=i("1227");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=i("499e").default;n("6ca71120",a,!0,{})},a00c:function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,"\n.duan-cell[data-v-462ea0ed] {\n  -webkit-box-flex: inherit;\n  -webkit-flex: inherit;\n      -ms-flex: inherit;\n          flex: inherit;\n}\n.fade-enter-active[data-v-462ea0ed],\n.fade-leave-active[data-v-462ea0ed] {\n  -webkit-transition: opacity 0.5s;\n  -o-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n}\n.fade-enter[data-v-462ea0ed],\n.fade-leave-to[data-v-462ea0ed] {\n  opacity: 0;\n}\n.cell-group[data-v-462ea0ed] {\n  background: none;\n}\n.cell-group .submit-cell[data-v-462ea0ed] {\n  background: none;\n  padding: 0.4rem;\n}\n.cell-group .cell[data-v-462ea0ed] {\n  margin-top: 0.1rem;\n}\n.cell-group .tag-cell[data-v-462ea0ed] {\n  -webkit-flex-wrap: wrap;\n      -ms-flex-wrap: wrap;\n          flex-wrap: wrap;\n}\n.cell-group .submit[data-v-462ea0ed] {\n  background: #ffd948;\n}\n.cell-group .friends-list[data-v-462ea0ed] {\n  color: #ffd948;\n  margin-right: 0.2rem;\n}\n.image-list[data-v-462ea0ed] {\n  margin: 0 -0.1rem;\n}\n.image-list .iamge-item[data-v-462ea0ed] {\n  padding: 0;\n}\n.image-list .image[data-v-462ea0ed] {\n  width: 100%;\n  height: 100%;\n  border-radius: 0.1rem;\n  overflow: hidden;\n}\n",""])}}]);